---
title: "Interactive Camden map"
author: "Martine Wauben"
date: "20/08/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(RSocrata)
library(dplyr)
library(magrittr)
library(leaflet)
library(renv)
# Load data
collisions <- RSocrata::read.socrata("https://opendata.camden.gov.uk/resource/puar-wf4h.csv") %>%
  dplyr::mutate_if(is.character, tolower)
```

```{r prepare spatial data}
collisions_sp <- collisions %>%
  dplyr::select(mode_of_travel, casualty_class, casualty_severity, pedestrian_crossing, longitude, latitude) %>%
  dplyr::mutate(type = dplyr::case_when(
    mode_of_travel == "1 pedestrian" ~ "pedestrian",
    mode_of_travel == "2 pedal cycle" ~ "bicycle",
    mode_of_travel == "4 car" ~ "car",
    TRUE ~ "other"
  ))
```

```{r prepare leaflet presets}
iconTypes <- iconList(
  bike = makeIcon("icons/bicycle.png", "icons/bicycle.png", 20, 20),
  car = makeIcon("icons/car.png", "icons/car.png", 20, 20),
  pedestrian = makeIcon("icons/pedestrian.png", "icons/pedestrian.png", 20, 20),
  other = makeIcon("icons/other.png", "icons/other.png", 20, 20)
)
```

```{r leaflet map}
leaflet(data = collisions_sp) %>% 
  addProviderTiles("CartoDB.Positron") %>% 
  setView(-0.153894, 51.535971, zoom = 12.5) %>% 
  addMarkers(~longitude, ~latitude, icon = ~iconTypes[type], clusterOptions = markerClusterOptions())
```
